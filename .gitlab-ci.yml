# services:
#   - name: docker:20.10.12-dind
#     command: ["--mtu=1440"]
#     alias: docker

stages:
  - build
  - deploy

build:
  stage: docker-build
  image: docker:latest
  services:
    - name: docker:20.10.12-dind
  before_script:
    - docker login -u "$CI_REGISTRY_USER" -p "$CI_REGISTRY_PASSWORD" $CI_REGISTRY
  script:
    - docker build --pull -t "$CI_REGISTRY_IMAGE" --build-arg HTTP_PROXY=$HTTP_PROXY --build-arg HTTPS_PROXY=$HTTPS_PROXY.
    - docker push "$CI_REGISTRY_IMAGE"
